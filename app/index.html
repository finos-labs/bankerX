<!DOCTYPE html>
<html>
  <head>
    <title>BankerX Demo App</title>
    <link rel="stylesheet" href="./styles.css"/>
    <script type="module">
      const qs = new URLSearchParams(window.location.search);
      const appName = qs.get("appName") || 'testApp';
      const directory = qs.get("directory") || 'test';
      const host = qs.get("host") || 'test.shared-nonprod';
      const appId = `${appName}@${directory}`;
      const interopHost = `https://${host}.connectifi-interop.com`;
      const modulePath = `${interopHost}/agent/main.bundle.js`;
    
      import(modulePath).then(async (mod) => {
        console.log(`agent loaded from: ${interopHost}, connecting as app: ${appId}`);
        await mod.createAgent(interopHost, appId, {
          logLevel: 'debug',
          props: {
            loginStyle: 'newWindow',
          },
          onChannelJoined: (evt) => console.log('channel joined', evt),
          onChannelLeft: () => console.log('channel left'),
          onFDC3Ready: async (fdc3) => {
            const info = await fdc3.getInfo();
            console.log('onFDC3Ready - info', info);
            fdc3.addIntentListener('ViewChart', (ctx) => {
              console.log('handleContext', ctx);
            });
            fdc3.addContextListener('fdc3.instrument', (ctx) => {
              console.log('handleContext', ctx);
            });
            window.fdc3 = fdc3;
            const purchaseButton = document.getElementById('initPurchaseButton');
            if (purchaseButton){
              purchaseButton.removeAttribute('disabled');
            }
          }
        });
        
      });
     
    </script>
    <script src="./main.js"></script>
  </head>
  <body>
    <div class="header">
        <h1>BankerX Demo</h1>
        <div class="actions">
          <button class="secondary" onclick="launchBankApp(1)">Launch Bank App 1</button>
          <button class="secondary" onclick="launchBankApp(2)">Launch Bank App 2</button>
          <button class="secondary" onclick="launchBankApp(3)">Launch Bank App 3</button>
          <button disabled id='initPurchaseButton' onclick="getTerms()">Start Purchase</button>
        </div>
    </div>
      <div class="pageContent">
        
      </div>
      <div id="modal" class="modal">
      </div>
      <div id="successModal" class="modal">
          <div class="textContainer">
            <div class="text"></div>
          </div>
          <div class="row cta">
            <button id="successCTA">OK</button>
          </div>
      </div>
    </div>
  </body>
</html>